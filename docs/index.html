<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>RegDashboard – Regulatory Intelligence</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="assets/style.css" />
</head>

<body>
  <header>
    <h1>Compliance &amp; Regulatory Quick-Access Dashboard</h1>
    <div class="subtitle">Rolling Regulatory Intelligence</div>

    <!-- Keep only the rolling window in the top banner -->
    <div class="header-meta">
      <div id="window" class="window"></div>
    </div>

    <nav class="nav">
      <a href="#ofac">OFAC</a>
      <a href="#irs">IRS</a>
      <a href="#payments">Payments</a>
      <a href="#banking">Banking</a>
      <a href="#mortgage">Mortgage</a>
      <a href="#usda">USDA</a>
      <a href="#exec">Legislative &amp; Executive</a>
      <a href="#infosec">Information Security</a>
      <a href="#fintech">Fintech Watch</a>
      <a href="#cardnet">Payment Card Networks</a>
      <a href="raw/" target="_blank" rel="noopener">Static Export (Copilot)</a>
    </nav>
  </header>

  <main id="content">
    <p id="loading">Loading items…</p>
  </main>

  <footer>
    <hr />

    <!-- MOVED FROM HEADER: counts + exports (except print) + force update -->
    <div class="footer-tools" style="display:grid; gap:10px; margin: 10px 0 16px 0;">
      <div id="count" style="font-size:13px; opacity:.9;"></div>
      <div id="debug-counts" style="font-size:12px; opacity:.85;"></div>

      <div style="font-size:13px;">
        Copilot-friendly exports:
        <a href="raw/" target="_blank" rel="noopener">Static Export</a>
        · <a href="raw/items.md" target="_blank" rel="noopener">items.md</a>
        · <a href="raw/items.txt" target="_blank" rel="noopener">items.txt</a>
        · <a href="raw/items.ndjson" target="_blank" rel="noopener">items.ndjson</a>
      </div>

      <div style="font-size:13px;">
        <a
          href="https://github.com/jasonw79118/regdashboard/actions/workflows/regdashboard-build.yml"
          target="_blank"
          rel="noopener"
          class="btn"
          style="display:inline-block;"
        >
          Force update (Run workflow)
        </a>
        <span style="margin-left:10px; opacity:.85;">
          Opens GitHub Actions — click <strong>Run workflow</strong> to rebuild now.
        </span>
      </div>

      <!-- Keep print separate (as requested) -->
      <div style="font-size:13px;">
        Print:
        <a href="print/items.html" target="_blank" rel="noopener">print/items.html</a>
      </div>
    </div>

    <p class="disclaimer">
      RegDashboard provides links and original summaries of publicly available regulatory and governmental information.
      Content remains the property of the originating agency or publisher. This site does not reproduce publications in full.
    </p>
    <p id="last-updated" style="margin:18px 0;text-align:center;font-size:12px;opacity:.75;"></p>
  </footer>

<script>
  window.addEventListener("DOMContentLoaded", () => {
    const GROUPS = [
      { id: "ofac",     title: "OFAC, Sanctions & AML", keys: ["OFAC"], accent: "#2563eb",
        sources: [
          ["OFAC Recent Actions", "https://ofac.treasury.gov/recent-actions"],
          ["Treasury Newsroom", "https://home.treasury.gov/news"]
        ]
      },
      { id: "irs",      title: "Taxes (IRS)", keys: ["IRS"], accent: "#16a34a",
        sources: [
          ["IRS Newsroom", "https://www.irs.gov/newsroom"],
          ["News Releases – Current Month", "https://www.irs.gov/newsroom/news-releases-for-current-month"],
          ["IRS Newswire (RSS)", "https://www.irs.gov/downloads/rss"]
        ]
      },
      { id: "payments", title: "Payments (Nacha & FRB)", keys: ["Payments"], accent: "#2563eb",
        sources: [
          ["NACHA News", "https://www.nacha.org/news"],
          ["NACHA Rules", "https://www.nacha.org/rules"],
          ["FRB Press Releases", "https://www.federalreserve.gov/newsevents/pressreleases.htm"],
          ["Fed360", "https://fed360.org/"]
        ]
      },
      { id: "banking",  title: "Federal Banking Agencies", keys: ["Banking"], accent: "#16a34a",
        sources: [
          ["OCC News Releases", "https://www.occ.gov/news-issuances/news-releases/index-news-releases.html"],
          ["FDIC Press Releases", "https://www.fdic.gov/news/press-releases/"],
          ["FRB Press Releases", "https://www.federalreserve.gov/newsevents/pressreleases.htm"]
        ]
      },
      { id: "mortgage", title: "Mortgage (MPF / GSE)", keys: ["Mortgage"], accent: "#16a34a",
        sources: [
          ["FHLB MPF News", "https://www.fhlbmpf.com/program-guildelines/mpf-program-updates"],
          ["Fannie Mae Newsroom", "https://www.fanniemae.com/newsroom/fannie-mae-news"],
          ["Freddie Mac Media Room", "https://www.freddiemac.com/media-room"]
        ]
      },
      { id: "usda",     title: "USDA (Rural Development)", keys: ["USDA", "USDA Rural Development"], accent: "#2563eb",
        sources: [
          ["USDA RD Bulletins", "https://content.govdelivery.com/accounts/USDARD/bulletins"]
        ]
      },
      { id: "exec",     title: "Legislative & Executive", keys: ["Legislative"], accent: "#16a34a",
        sources: [
          ["Senate Banking Newsroom", "https://www.banking.senate.gov/newsroom"],
          ["White House News", "https://www.whitehouse.gov/news/"],
          ["Federal Register", "https://www.federalregister.gov/"]
        ]
      },
      { id: "infosec",  title: "Information Security", keys: ["IS", "Information Security"], accent: "#2563eb",
        sources: [
          ["BleepingComputer", "https://www.bleepingcomputer.com/"],
          ["Microsoft MSRC", "https://msrc.microsoft.com/"]
        ]
      },
      { id: "fintech",  title: "Fintech Watch", keys: ["Fintech Watch", "Fintech"], accent: "#16a34a",
        sources: [
          ["FIS Investor News", "https://investor.fisglobal.com/press-releases"],
          ["Fiserv Newsroom", "https://investors.fiserv.com/newsroom/news-releases"],
          ["Jack Henry IR", "https://ir.jackhenry.com/press-releases"],
          ["Temenos Press Releases", "https://www.temenos.com/news/press-releases/"]
        ]
      },
      { id: "cardnet",  title: "Payment Card Networks", keys: [
        "Payment Card Network","Payment Card Networks","Card Network","Card Networks","Visa","Mastercard"
      ], accent: "#2563eb",
        sources: [
          ["Visa Press Releases", "https://usa.visa.com/about-visa/newsroom/press-releases-listing.html"],
          ["Mastercard Press", "https://www.mastercard.com/us/en/news-and-trends/press.html"]
        ]
      },
    ];

    function $(id) { return document.getElementById(id); }

    function fmtDate(iso) {
      const d = new Date(iso);
      if (Number.isNaN(d.getTime())) return "";
      return d.toLocaleDateString(undefined, { year: "numeric", month: "short", day: "2-digit" });
    }

    function normalizeKey(k) {
      const s = String(k || "").trim();
      if (!s) return "";
      const lower = s.toLowerCase();

      if (lower === "infosec" || lower === "info sec" || lower === "information security") return "IS";
      if (lower === "is") return "IS";

      if (lower === "fintech watch" || lower === "fintech") return "Fintech Watch";

      if (lower === "usda rural development") return "USDA";
      if (lower === "usda") return "USDA";

      if (lower === "payment card networks" || lower === "payment card network" || lower === "card networks" || lower === "card network") return "Payment Card Network";
      if (lower === "visa" || lower === "mastercard") return "Payment Card Network";

      return s;
    }

    function itemKey(i) {
      if (!i) return "";
      return normalizeKey(i.category || i.source || "");
    }

    function renderSources(group) {
      const srcs = group.sources || [];
      if (!srcs.length) return "";
      const links = srcs.map(([label, url]) => `<a href="${url}" target="_blank" rel="noopener">${label}</a>`).join(" · ");
      return `Sources: ${links}`;
    }

    function renderSection(group, items, tilesWrap) {
      const section = document.createElement("section");
      section.id = group.id;
      section.className = "tile";
      section.style.setProperty("--accent", group.accent || "#2563eb");

      const head = document.createElement("div");
      head.className = "tile-head";
      head.innerHTML = `<h2>${group.title}</h2>`;
      section.appendChild(head);

      const body = document.createElement("div");
      body.className = "tile-body";

      const groupKeys = (group.keys || []).map(normalizeKey);
      const groupItems = (items || [])
        .filter(i => groupKeys.includes(itemKey(i)))
        .sort((a, b) => new Date(b.published_at) - new Date(a.published_at));

      if (!groupItems.length) {
        const empty = document.createElement("div");
        empty.className = "empty";
        empty.textContent = "No items in the current rolling window.";
        body.appendChild(empty);
      } else {
        const ul = document.createElement("ul");
        ul.className = "items";

        groupItems.forEach(i => {
          const li = document.createElement("li");
          li.innerHTML = `
            <div class="headline">
              <div>
                <span class="source">[${i.source}]</span>
                <a href="${i.url}" target="_blank" rel="noopener">${i.title}</a>
              </div>
              <span class="date">${fmtDate(i.published_at)}</span>
            </div>
            ${i.summary ? `<div class="summary">${i.summary}</div>` : ""}
          `;
          ul.appendChild(li);
        });

        body.appendChild(ul);
      }

      section.appendChild(body);

      const foot = document.createElement("div");
      foot.className = "tile-foot";
      foot.innerHTML = renderSources(group);
      section.appendChild(foot);

      tilesWrap.appendChild(section);
    }

    function dataUrl() {
      const here = new URL(window.location.href);
      const dir = here.href.endsWith("/") ? here.href : (here.href + "/");
      const u = new URL("data/items.json", dir);
      u.searchParams.set("v", String(Date.now()));
      return u.toString();
    }

    function renderDebugCounts(items) {
      const el = $("debug-counts");
      if (!el) return;
      const counts = {};
      (items || []).forEach(it => {
        const k = String(it.category || it.source || "").trim();
        counts[k] = (counts[k] || 0) + 1;
      });
      const keys = Object.keys(counts).sort((a,b)=>counts[b]-counts[a]);
      el.textContent = keys.length
        ? ("Loaded categories: " + keys.map(k => `${k}=${counts[k]}`).join(" · "))
        : "Loaded categories: (none)";
    }

    (async () => {
      const content = $("content");
      if (!content) return;

      const loading = $("loading");

      try {
        const url = dataUrl();
        const r = await fetch(url, { cache: "no-store" });
        if (!r.ok) throw new Error(`HTTP ${r.status} loading ${url}`);
        const data = await r.json();

        const w = $("window");
        if (w) w.textContent = `Rolling window: ${fmtDate(data.window_start)} → ${fmtDate(data.window_end)} (UTC)`;

        const c = $("count");
        if (c) c.textContent = `Total items loaded: ${(data.items || []).length}`;

        const last = $("last-updated");
        if (last) {
          const ct = data.generated_at_ct || "";
          const utc = data.generated_at_utc || "";
          last.textContent = ct
            ? `Last updated: ${ct} (CT)${utc ? " — " + utc + " (UTC)" : ""}`
            : (utc ? `Last updated: ${utc} (UTC)` : "");
        }

        renderDebugCounts(data.items || []);

        if (loading) loading.remove();
        content.innerHTML = "";

        const tilesWrap = document.createElement("div");
        tilesWrap.className = "tiles";
        content.appendChild(tilesWrap);

        GROUPS.forEach(g => renderSection(g, data.items || [], tilesWrap));
      } catch (e) {
        if (loading) loading.remove();
        console.error(e);

        content.innerHTML = `
          <div class="tile" style="--accent:#ff2aa3;">
            <div class="tile-head"><h2>Could not load dashboard data</h2></div>
            <div class="tile-body">
              <div class="empty" style="color:#8a004d;"><strong>${String(e)}</strong></div>
              <p style="margin:12px 0 0 0; font-size:13px; color:rgba(2,6,23,.75);">
                Try:
                <a href="raw/" target="_blank" rel="noopener">Static Export</a> ·
                <a href="raw/index.html" target="_blank" rel="noopener">raw/index.html</a> ·
                <a href="print/items.html" target="_blank" rel="noopener">print/items.html</a>
              </p>
            </div>
            <div class="tile-foot"></div>
          </div>
        `;
      }
    })();
  });
</script>
</body>
</html>
